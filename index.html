<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BUZZ PETS FOOD Survey</title>

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Kanit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #05314a;
      --primary-light: #0a4563;
      --primary-dark: #042638;
      --secondary-color: #05314a;
      --accent-color: #3db3e3;
      --text-light: #ffffff;
      --text-dark: #333333;
      --error-color: #ff5252;
      --success-color: #4caf50;
      --border-radius: 12px;
      --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Kanit', 'Prompt', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #0b3b51;
      color: var(--text-light);
      line-height: 1.6;
    }
    
    .container {
      max-width: 850px;
      margin: 20px auto;
      padding: 0;
      background-color: #05314a;
      box-shadow: var(--box-shadow);
      border-radius: var(--border-radius);
      overflow: hidden;
      position: relative;
    }
    
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 0;
      text-align: center;
      margin-bottom: 0;
      height: auto;
      position: relative;
      overflow: hidden;
    }
    
    .logo-image {
      width: 100%;
      height: auto;
      display: block;
      max-width: 100%;
      object-fit: cover;
      transition: var(--transition);
    }
    
    .logo-image:hover {
      transform: scale(1.02);
    }
    
    h1 {
      color: var(--primary-color);
      text-align: center;
      margin: 20px 0;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .form-content {
      padding: 30px 40px 40px;
      background-color: #05314a;
      color: var(--text-light);
      position: relative;
    }
    
    .form-group {
      margin-bottom: 25px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-light);
      font-size: 1rem;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 14px;
      border: 1px solid #e1e5e9;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 16px;
      font-family: 'Kanit', 'Prompt', Arial, sans-serif;
      background-color: #f9fafc;
      transition: var(--transition);
      color: var(--text-dark);
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(61, 179, 227, 0.3);
      outline: none;
    }
    
    input[type="text"]::placeholder,
    input[type="number"]::placeholder,
    input[type="email"]::placeholder,
    input[type="tel"]::placeholder,
    textarea::placeholder {
      color: #aab2bd;
      font-weight: 300;
    }
    
    select {
      height: 52px;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2305314a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .btn {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      color: white;
      padding: 15px 20px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      font-family: 'Kanit', 'Prompt', Arial, sans-serif;
      width: 100%;
      transition: var(--transition);
      margin-top: 30px;
      text-transform: none;
      letter-spacing: normal;
      box-shadow: 0 4px 10px rgba(5, 49, 74, 0.2);
    }
    
    .btn:hover {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-color) 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(5, 49, 74, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 5px rgba(5, 49, 74, 0.2);
    }
    
    .checkbox-group {
      margin-top: 10px;
    }
    
    .checkbox-container {
      display: flex;
      align-items: flex-start;
      margin-bottom: 15px;
      padding: 20px;
      border-radius: var(--border-radius);
      background-color: #07476c;
      transition: var(--transition);
      border-left: 4px solid var(--accent-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .checkbox-container:hover {
      background-color: #095e8c;
      transform: translateX(4px);
    }
    
    .checkbox-container input[type="checkbox"] {
      margin-right: 12px;
      margin-top: 4px;
      width: 20px;
      height: 20px;
      accent-color: var(--primary-color);
    }

    .checkbox-label {
      flex: 1;
      color: var(--text-light);
      line-height: 1.5;
      font-weight: 400;
      font-size: 0.95rem;
    }
    
    .terms-box {
      background-color: #07476c;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 25px;
      border-left: 4px solid var(--accent-color);
      font-size: 15px;
      color: var(--text-light);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    #loading {
      display: none;
      text-align: center;
      margin-top: 30px;
    }
    
    .spinner {
      border: 4px solid rgba(61, 179, 227, 0.2);
      border-top: 4px solid var(--accent-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    .thank-you-message {
      display: none;
      text-align: center;
      margin-top: 20px;
      padding: 40px;
      background-color: #07476c;
      border-radius: var(--border-radius);
      border-left: 4px solid var(--success-color);
      color: #ffffff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      position: relative;
      z-index: 100;
    }
    
    .thank-you-message h2 {
      color: #ffffff;
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: 600;
    }
    
    .thank-you-message p {
      font-size: 16px;
      line-height: 1.7;
      margin-bottom: 10px;
    }
    
    .error-message {
      color: var(--error-color);
      font-size: 14px;
      margin-top: 5px;
      display: none;
      font-weight: 400;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .required-field::after {
      content: " *";
      color: var(--error-color);
      font-weight: bold;
    }
    
    .form-section {
      border-bottom: 1px solid #07476c;
      padding-bottom: 30px;
      margin-bottom: 30px;
      transition: var(--transition);
    }
    
    .form-section:hover {
      background-color: #06405f;
      padding: 20px;
      border-radius: var(--border-radius);
      margin: -20px -20px 30px -20px;
    }
    
    .form-section:last-child {
      border-bottom: none;
    }
    
    .form-section-title {
      color: var(--text-light);
      margin-bottom: 25px;
      padding-bottom: 12px;
      border-bottom: 2px solid #ffffff;
      font-size: 22px;
      font-weight: 500;
      position: relative;
      display: inline-block;
    }
    
    .form-section-title::after {
      content: "";
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 60px;
      height: 2px;
      background-color: var(--accent-color);
    }
    
    .file-input-container {
      margin-top: 15px;
      position: relative;
    }
    
    .file-input-container input[type="file"] {
      padding: 15px;
      background-color: #07476c;
      border: 2px dashed #90a4ae;
      border-radius: var(--border-radius);
      transition: var(--transition);
      width: 100%;
      cursor: pointer;
      color: #ffffff;
    }
    
    .file-input-container input[type="file"]:hover {
      border-color: var(--accent-color);
      background-color: #095e8c;
    }
    
    #imagePreview {
      max-width: 100%;
      margin-top: 15px;
      display: none;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    #uploadedImagesPreview {
      margin-top: 15px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: var(--border-radius);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    #uploadedImagesPreview > div {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      max-width: 100%;
    }
    
    .image-preview-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background-color: #f5f5f5;
      transition: transform 0.2s ease;
    }
    
    .image-preview-item:hover {
      transform: scale(1.05);
    }
    
    .image-preview-item img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      display: block;
    }
    
    .image-number {
      position: absolute;
      top: 5px;
      left: 5px;
      background-color: rgba(5, 49, 74, 0.8);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    #fileCount {
      margin-top: 8px;
      font-size: 0.9rem;
      color: var(--accent-color);
      font-weight: 500;
      text-align: center;
      background-color: rgba(61, 179, 227, 0.1);
      padding: 5px 10px;
      border-radius: 15px;
      display: inline-block;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 0;
    }
    
    .form-col {
      flex: 1;
    }
    
    .phone-input-container {
      display: flex;
      align-items: center;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e1e5e9;
      background-color: #f9fafc;
      transition: var(--transition);
    }
    
    .phone-input-container:focus-within {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(61, 179, 227, 0.2);
    }
    
    .phone-prefix {
      padding: 14px;
      background-color: #e7eef5;
      color: var(--primary-color);
      font-weight: 500;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
    }
    
    .phone-input {
      flex: 1;
      border: none !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      margin: 0;
    }
    
    .phone-input:focus {
      box-shadow: none !important;
    }
    
    .radio-container {
      display: flex;
      gap: 25px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .radio-item {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background-color: #07476c;
      border-radius: 25px;
      transition: var(--transition);
      cursor: pointer;
      color: #ffffff;
    }
    
    .radio-item:hover {
      background-color: #095e8c;
      transform: translateY(-2px);
    }
    
    .radio-item input[type="radio"] {
      margin-right: 8px;
      width: 18px;
      height: 18px;
      accent-color: var(--primary-color);
    }
    
    .page-title {
      position: relative;
      padding: 25px 0;
      margin-top: 0;
      background: linear-gradient(to right, var(--primary-dark), var(--primary-color), var(--primary-light));
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .page-title h1 {
      margin: 0;
      color: white;
      font-size: 28px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .page-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background-color: var(--accent-color);
      border-radius: 2px;
    }
    
    .asterisk-note {
      font-size: 13px;
      color: #90a4ae;
      margin-top: 8px;
      display: block;
      font-style: italic;
    }
    
    .mobile-only {
      display: none;
    }
    
    .birth-date-container {
      display: flex;
      gap: 10px;
    }

    .birth-date-container select {
      flex: 1;
      height: 52px;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2305314a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
      font-size: 16px;
      border: 1px solid #e1e5e9;
      border-radius: 8px;
      background-color: #f9fafc;
      color: var(--text-dark);
      transition: var(--transition);
    }

    .birth-date-container select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(61, 179, 227, 0.2);
      outline: none;
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 0;
    }

    .checkbox-group .checkbox-item {
      display: flex;
      align-items: flex-start;
      padding: 12px 15px;
      background-color: #07476c;
      border-radius: 8px;
      transition: var(--transition);
      border-left: 3px solid var(--accent-color);
      margin-bottom: 8px;
    }

    .checkbox-group .checkbox-item:hover {
      background-color: #095e8c;
      transform: translateX(3px);
    }

    .checkbox-group .checkbox-item input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 2px;
      width: 16px;
      height: 16px;
      accent-color: var(--accent-color);
    }

    .checkbox-group .checkbox-item label {
      flex: 1;
      margin-bottom: 0;
      color: var(--text-light);
      font-size: 0.9rem;
      line-height: 1.3;
      cursor: pointer;
    }

    .collapsible-section {
      border: 1px solid #07476c;
      border-radius: var(--border-radius);
      margin-top: 10px;
      overflow: hidden;
      background-color: #07476c;
    }

    .collapsible-header {
      background-color: #07476c;
      color: var(--text-light);
      padding: 15px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
      border: none;
      width: 100%;
      text-align: left;
      font-size: 1rem;
      font-weight: 500;
    }

    .collapsible-header:hover {
      background-color: #095e8c;
    }

    .collapsible-header .arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .collapsible-header.active .arrow {
      transform: rotate(180deg);
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background-color: #06405f;
    }

    .collapsible-content.active {
      max-height: 400px;
      overflow-y: auto;
    }

    .collapsible-inner {
      padding: 20px;
    }

    .collapsible-inner .checkbox-group {
      margin-top: 0;
    }

    .selected-count {
      background-color: var(--accent-color);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
      min-width: 20px;
      text-align: center;
    }

    .selected-items-preview {
      margin-top: 10px;
      padding: 12px;
      background-color: #06405f;
      border-radius: 8px;
      border-left: 3px solid var(--accent-color);
      font-size: 0.9rem;
      color: var(--text-light);
      line-height: 1.4;
    }

    .selected-items-preview:empty {
      display: none;
    }

    .selected-items-preview .preview-label {
      font-weight: 500;
      color: var(--accent-color);
      margin-bottom: 5px;
    }

    .selected-items-preview .preview-items {
      color: #E0E0E0;
    }

    .factors-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .factor-item {
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .factor-item label {
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .factor-item .form-group {
      margin-bottom: 0;
    }

    .hidden-field {
      display: none;
      animation: fadeOut 0.3s ease-out;
    }

    .form-group:not(.hidden-field) {
      animation: fadeIn 0.4s ease-out;
    }

    .form-group {
      transition: all 0.3s ease;
    }

    .form-group.newly-shown {
      animation: fadeIn 0.4s ease-out, highlightField 1.5s ease-out;
    }

    @keyframes highlightField {
      0% { background-color: rgba(61, 179, 227, 0.1); }
      100% { background-color: transparent; }
    }

    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    textarea:focus {
      box-shadow: 0 0 0 3px rgba(61, 179, 227, 0.3);
      border-color: var(--accent-color);
      outline: none;
    }
    
    @media (max-width: 768px) {
      .mobile-only {
        display: inline;
      }
      
      .form-title {
        font-size: 24px;
        line-height: 1.3;
      }
        
      .form-content {
        padding: 20px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .page-title h1 {
        font-size: 24px;
      }
      
      .form-section-title {
        font-size: 20px;
      }
      
      .birth-date-container {
        flex-direction: column;
        gap: 8px;
      }
    
      .birth-date-container select {
        width: 100%;
        margin-bottom: 5px;
      }

      .factors-container {
        grid-template-columns: 1fr;
      }

      .collapsible-content.active {
        max-height: 300px;
      }

      .collapsible-header {
        padding: 12px 15px;
        font-size: 0.95rem;
      }

      .collapsible-inner {
        padding: 15px;
      }

      .selected-count {
        font-size: 0.75rem;
        padding: 1px 6px;
      }

      .checkbox-group .checkbox-item {
        padding: 10px 12px;
      }

      .checkbox-group .checkbox-item label {
        font-size: 0.85rem;
      }
    
      #uploadedImagesPreview > div {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 8px;
      }
    
      .image-preview-item img {
        height: 80px;
      }
    
      .image-number {
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
      }
    
      #fileCount {
        font-size: 0.8rem;
        padding: 4px 8px;
      }
        
      .btn {
        background: linear-gradient(135deg, #07476c 0%, #0a5a85 100%);
        color: white;
        padding: 15px 20px;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 18px;
        font-weight: 500;
        width: 100%;
        transition: var(--transition);
        margin-top: 30px;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 10px rgba(5, 49, 74, 0.2);
      }

      .btn:hover {
        background: linear-gradient(135deg, #0a5a85 0%, #07476c 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(5, 49, 74, 0.3);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-section {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    .form-section:nth-child(2) { animation-delay: 0.1s; }
    .form-section:nth-child(3) { animation-delay: 0.2s; }
    .form-section:nth-child(4) { animation-delay: 0.3s; }
    .form-section:nth-child(5) { animation-delay: 0.4s; }
    
    #errorMessages {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: var(--border-radius);
      background-color: #ffebee;
      color: var(--error-color);
      font-weight: 500;
      display: none;
      animation: fadeIn 0.3s ease-out;
      border-left: 4px solid var(--error-color);
    }
    
    input[type="checkbox"]:focus,
    input[type="radio"]:focus {
      outline: 2px solid var(--accent-color);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://i.postimg.cc/0NP58LpV/COVER.jpg" alt="BUZZ PETS FOOD" class="logo-image">
    </div>
    
    <div class="page-title">
      <h1 class="form-title">
        BUZZ กินดี แจกฟรีแสนซอง<br>
        ท้าพิสูจน์ความอร่อย พร้อมสุขภาพดี<br>
        ด้วย Buzz Netura ขนาดทดลอง<br>
        <span style="color: #ffffff; font-weight: bold;">พร้อมส่วนลด 15%*</span><br>
        <span style="font-size: 0.85em; color: #E0E0E0;">ตั้งแต่วันนี้ – 31 ธ.ค. 2568<br class="mobile-only"> (หรือจนกว่าสินค้าจะหมด)</span>
      </h1>
      
      <div style="font-size: 0.75em; color: #B0C4DE; line-height: 1.4; margin-top: 15px; padding: 0 20px; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto;">
        <p style="margin-bottom: 8px;">
          เพียงร่วมตอบแบบสอบถามครบตามที่กำหนด มีสิทธิ์ได้รับผลิตภัณฑ์ขนาดทดลอง
        </p>
        <p style="margin-bottom: 8px; font-size: 0.9em; color: #FFD700;">
          (สงวนสิทธิ์การรับผลิตภัณฑ์สำหรับผู้ที่ไม่เคยใช้ผลิตภัณฑ์อาหารแมวหรือสุนัข<br>
          Buzz Netura Holistic Grain Free มาก่อน จำกัดจำนวน 1 ชิ้น/1 ท่าน/1 ที่อยู่)
        </p>
        <p style="margin-bottom: 8px;">
          โดยทางบริษัทฯ จะจัดส่งภายใน 30 วันทำการ<br>
          (นับจากวันที่ทำแบบสอบถามและกดส่งแบบสอบถามเรียบร้อย)
        </p>
        <p style="font-size: 0.85em; color: #8A94A0; font-style: italic; margin-top: 10px;">
          *เงื่อนไขเป็นไปตามที่บริษัทฯ กำหนดและอาจมีการเปลี่ยนแปลงโดยไม่ต้องแจ้งให้ทราบล่วงหน้า
        </p>
      </div>
    </div>
    
    <div class="form-content">
      <div id="formContainer">
        <form id="surveyForm">
          
          <!-- 1. ข้อมูลส่วนตัว -->
          <div class="form-section">
            <h3 class="form-section-title">ข้อมูลส่วนตัว</h3>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="firstName" class="required-field">ชื่อ</label>
                  <input type="text" id="firstName" name="firstName" required placeholder="กรุณากรอกชื่อ">
                  <div id="firstNameError" class="error-message">กรุณากรอกชื่อ</div>
                </div>
              </div>
              
              <div class="form-col">
                <div class="form-group">
                  <label for="lastName" class="required-field">นามสกุล</label>
                  <input type="text" id="lastName" name="lastName" required placeholder="กรุณากรอกนามสกุล">
                  <div id="lastNameError" class="error-message">กรุณากรอกนามสกุล</div>
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="gender" class="required-field">เพศ</label>
                  <div class="radio-container">
                    <div class="radio-item">
                      <input type="radio" id="genderMale" name="gender" value="ชาย" required>
                      <label for="genderMale">ชาย</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="genderFemale" name="gender" value="หญิง" required>
                      <label for="genderFemale">หญิง</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="genderLGBTQ" name="gender" value="LGBTQ+" required>
                      <label for="genderLGBTQ">LGBTQ+</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="genderNotSpecified" name="gender" value="ไม่ระบุ" required>
                      <label for="genderNotSpecified">ไม่ระบุ</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
              
            <div class="form-col">
              <div class="form-group">
                <label for="birthDate" class="required-field">วันเดือนปีเกิด</label>
                <div class="birth-date-container" style="display: flex; gap: 10px;">
                  <!-- วัน -->
                  <select id="birthDay" name="birthDay" required style="flex: 1;">
                    <option value="">วัน</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                  </select>
                  
                  <!-- เดือน -->
                  <select id="birthMonth" name="birthMonth" required style="flex: 1;">
                    <option value="">เดือน</option>
                    <option value="มกราคม">มกราคม</option>
                    <option value="กุมภาพันธ์">กุมภาพันธ์</option>
                    <option value="มีนาคม">มีนาคม</option>
                    <option value="เมษายน">เมษายน</option>
                    <option value="พฤษภาคม">พฤษภาคม</option>
                    <option value="มิถุนายน">มิถุนายน</option>
                    <option value="กรกฎาคม">กรกฎาคม</option>
                    <option value="สิงหาคม">สิงหาคม</option>
                    <option value="กันยายน">กันยายน</option>
                    <option value="ตุลาคม">ตุลาคม</option>
                    <option value="พฤศจิกายน">พฤศจิกายน</option>
                    <option value="ธันวาคม">ธันวาคม</option>
                  </select>
                  
                  <!-- ปี (พ.ศ.) -->
                  <select id="birthYear" name="birthYear" required style="flex: 1;">
                    <option value="">ปี (พ.ศ.)</option>
                    <option value="2567">2567</option>
                    <option value="2566">2566</option>
                    <option value="2565">2565</option>
                    <option value="2564">2564</option>
                    <option value="2563">2563</option>
                    <option value="2562">2562</option>
                    <option value="2561">2561</option>
                    <option value="2560">2560</option>
                    <option value="2559">2559</option>
                    <option value="2558">2558</option>
                    <option value="2557">2557</option>
                    <option value="2556">2556</option>
                    <option value="2555">2555</option>
                    <option value="2554">2554</option>
                    <option value="2553">2553</option>
                    <option value="2552">2552</option>
                    <option value="2551">2551</option>
                    <option value="2550">2550</option>
                    <option value="2549">2549</option>
                    <option value="2548">2548</option>
                    <option value="2547">2547</option>
                    <option value="2546">2546</option>
                    <option value="2545">2545</option>
                    <option value="2544">2544</option>
                    <option value="2543">2543</option>
                    <option value="2542">2542</option>
                    <option value="2541">2541</option>
                    <option value="2540">2540</option>
                    <option value="2539">2539</option>
                    <option value="2538">2538</option>
                    <option value="2537">2537</option>
                    <option value="2536">2536</option>
                    <option value="2535">2535</option>
                    <option value="2534">2534</option>
                    <option value="2533">2533</option>
                    <option value="2532">2532</option>
                    <option value="2531">2531</option>
                    <option value="2530">2530</option>
                    <option value="2529">2529</option>
                    <option value="2528">2528</option>
                    <option value="2527">2527</option>
                    <option value="2526">2526</option>
                    <option value="2525">2525</option>
                    <option value="2524">2524</option>
                    <option value="2523">2523</option>
                    <option value="2522">2522</option>
                    <option value="2521">2521</option>
                    <option value="2520">2520</option>
                    <option value="2519">2519</option>
                    <option value="2518">2518</option>
                    <option value="2517">2517</option>
                    <option value="2516">2516</option>
                    <option value="2515">2515</option>
                    <option value="2514">2514</option>
                    <option value="2513">2513</option>
                    <option value="2512">2512</option>
                    <option value="2511">2511</option>
                    <option value="2510">2510</option>
                    <option value="2509">2509</option>
                    <option value="2508">2508</option>
                    <option value="2507">2507</option>
                    <option value="2506">2506</option>
                    <option value="2505">2505</option>
                    <option value="2504">2504</option>
                    <option value="2503">2503</option>
                    <option value="2502">2502</option>
                    <option value="2501">2501</option>
                    <option value="2500">2500</option>
                    <option value="2499">2499</option>
                    <option value="2498">2498</option>
                    <option value="2497">2497</option>
                    <option value="2496">2496</option>
                    <option value="2495">2495</option>
                    <option value="2494">2494</option>
                    <option value="2493">2493</option>
                    <option value="2492">2492</option>
                    <option value="2491">2491</option>
                    <option value="2490">2490</option>
                    <option value="2489">2489</option>
                    <option value="2488">2488</option>
                    <option value="2487">2487</option>
                    <option value="2486">2486</option>
                    <option value="2485">2485</option>
                    <option value="2484">2484</option>
                    <option value="2483">2483</option>
                    <option value="2482">2482</option>
                    <option value="2481">2481</option>
                    <option value="2480">2480</option>
                    <option value="2479">2479</option>
                    <option value="2478">2478</option>
                    <option value="2477">2477</option>
                    <option value="2476">2476</option>
                    <option value="2475">2475</option>
                    <option value="2474">2474</option>
                    <option value="2473">2473</option>
                    <option value="2472">2472</option>
                    <option value="2471">2471</option>
                    <option value="2470">2470</option>
                    <option value="2469">2469</option>
                    <option value="2468">2468</option>
                    <option value="2467">2467</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="occupation" class="required-field">อาชีพ</label>
              <select id="occupation" name="occupation" required onchange="toggleOccupationOther()">
                <option value="">-- กรุณาเลือก --</option>
                <option value="นักเรียน/นักศึกษา">นักเรียน/นักศึกษา</option>
                <option value="พนักงานบริษัทเอกชน">พนักงานบริษัทเอกชน</option>
                <option value="เจ้าของธุรกิจ">เจ้าของธุรกิจ</option>
                <option value="รัฐวิสาหกิจ/ราชการ">รัฐวิสาหกิจ/ราชการ</option>
                <option value="รับจ้างอิสระ">รับจ้างอิสระ</option>
                <option value="ว่างงาน">ว่างงาน</option>
                <option value="อื่น ๆ">อื่น ๆ</option>
              </select>
            </div>

            <!-- กรอกอาชีพ (อื่นๆ) -->
            <div class="form-group hidden-field" id="occupationOtherGroup">
              <label for="occupationOther">กรุณาระบุอาชีพ</label>
              <input type="text" id="occupationOther" name="occupationOther" placeholder="กรุณาระบุอาชีพ">
            </div>

            <!-- รายได้ต่อเดือน -->
            <div class="form-group">
              <label for="monthlyIncome" class="required-field">รายได้ต่อเดือน</label>
              <select id="monthlyIncome" name="monthlyIncome" required>
                <option value="">-- กรุณาเลือก --</option>
                <option value="น้อยกว่า 20,000 บาท">น้อยกว่า 20,000 บาท</option>
                <option value="20,001-60,000 บาท">20,001-60,000 บาท</option>
                <option value="60,001-100,000 บาท">60,001-100,000 บาท</option>
                <option value="มากกว่า 100,000 บาท">มากกว่า 100,000 บาท</option>
              </select>
            </div>
          </div>
          
          <!-- 2. ข้อมูลสัตว์เลี้ยง -->
          <div class="form-section">
            <h3 class="form-section-title">ข้อมูลสัตว์เลี้ยง</h3>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="petType" class="required-field">สัตว์เลี้ยงที่คุณมี</label>
                  <select id="petType" name="petType" required onchange="updatePetBrandsAndSampleOptions()">
                    <option value="">-- กรุณาเลือก --</option>
                    <option value="สุนัข">สุนัข</option>
                    <option value="แมว">แมว</option>
                    <option value="สุนัขและแมว">สุนัขและแมว</option>
                  </select>
                </div>
              </div>
              
              <div class="form-col">
                <div class="form-group">
                  <label for="petCount" class="required-field">จำนวนสัตว์เลี้ยง</label>
                  <select id="petCount" name="petCount" required>
                    <option value="">-- กรุณาเลือก --</option>
                    <option value="1 ตัว">1 ตัว</option>
                    <option value="2 ตัว">2 ตัว</option>
                    <option value="3 ตัว">3 ตัว</option>
                    <option value="4 ตัว">4 ตัว</option>
                    <option value="มากกว่า 5 ตัว">มากกว่า 5 ตัว</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="currentBrand" class="required-field">แบรนด์อาหารเม็ดที่ใช้อยู่ปัจจุบัน (เลือกได้หลายข้อ)</label>
                  
                  <div class="collapsible-section">
                    <button type="button" class="collapsible-header" onclick="toggleCollapsible('brandCollapse')">
                      <span>เลือกแบรนด์</span>
                      <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="selected-count" id="brandSelectedCount">0</span>
                        <span class="arrow">▼</span>
                      </div>
                    </button>
                    
                    <div class="collapsible-content" id="brandCollapse">
                      <div class="collapsible-inner">
                        <div class="checkbox-group" id="brandCheckboxGroup">
                          <!-- Brand checkboxes will be populated by JavaScript -->
                        </div>
                        
                        <!-- กล่องกรอกอื่นๆ สำหรับแบรนด์ -->
                        <div class="form-group hidden-field" id="brandOtherGroup" style="margin-top: 15px;">
                          <input type="text" id="currentBrandOther" name="currentBrandOther" placeholder="กรุณาระบุแบรนด์อาหารเม็ดที่ใช้">
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- แสดงรายการแบรนด์ที่เลือกไว้ -->
                  <div class="selected-items-preview" id="brandSelectedPreview"></div>
                </div>
              </div>
              
              <div class="form-col">
                <div class="form-group">
                  <label for="monthlyExpense" class="required-field">ค่าใช้จ่ายสำหรับสัตว์เลี้ยง (ต่อตัว ต่อเดือน)</label>
                  <select id="monthlyExpense" name="monthlyExpense" required>
                    <option value="">-- กรุณาเลือก --</option>
                    <option value="ต่ำกว่า 1,000 บ.">ต่ำกว่า 1,000 บ.</option>
                    <option value="1,001 - 3,000 บ.">1,001 - 3,000 บ.</option>
                    <option value="3,001 - 5,000 บ.">3,001 - 5,000 บ.</option>
                    <option value="5,001 - 7,000 บ.">5,001 - 7,000 บ.</option>
                    <option value="7,001 - 9,000 บ.">7,001 - 9,000 บ.</option>
                    <option value="มากกว่า 9,000 บ.">มากกว่า 9,000 บ.</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- กรุณาอัพโหลด -->
            <div class="form-group">
              <label for="receiptUpload">กรุณาอัพโหลดภาพถ่ายถุงอาหารเม็ดสำหรับแมว หรือสุนัขที่คุณใช้อยู่ปัจจุบัน</label>
              <div class="file-input-container">
                <input type="file" id="receiptUpload" name="receiptUpload" accept="image/*" multiple onchange="previewUploadedImages(this)">
                <span class="asterisk-note">รองรับไฟล์ภาพ เช่น JPG, PNG (สามารถเลือกได้ 1-5 รูป)</span>
              </div>
              <!-- Container สำหรับแสดงรูปภาพหลายรูป -->
              <div id="uploadedImagesPreview" style="display: none; margin-top: 15px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; max-width: 100%;"></div>
              </div>
              <!-- แสดงจำนวนไฟล์ที่เลือก -->
              <div id="fileCount" style="margin-top: 8px; font-size: 0.9rem; color: var(--accent-color); display: none;"></div>
            </div>

            <!-- เหตุผลที่ไม่เลือกซื้ออาหารสุนัขหรือแมว Buzz Netura -->
            <div class="form-group">
              <label>เหตุผลที่ไม่เลือกซื้ออาหารสุนัขหรือแมว Buzz Netura? (ตอบได้หลายข้อ)</label>
              
              <div class="collapsible-section">
                <button type="button" class="collapsible-header" onclick="toggleCollapsible('reasonCollapse')">
                  <span>เลือกเหตุผล</span>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="selected-count" id="reasonSelectedCount">0</span>
                    <span class="arrow">▼</span>
                  </div>
                </button>
                
                <div class="collapsible-content" id="reasonCollapse">
                  <div class="collapsible-inner">
                    <div class="checkbox-group">
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason1" name="reasonNotBuyBuzz" value="ไม่รู้จักแบรนด์นี้" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason1">ไม่รู้จักแบรนด์นี้</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason2" name="reasonNotBuyBuzz" value="ราคาสูงเกินไป" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason2">ราคาสูงเกินไป</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason3" name="reasonNotBuyBuzz" value="ไม่มั่นใจในคุณภาพ ไม่น่าเชื่อถือ" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason3">ไม่มั่นใจในคุณภาพ ไม่น่าเชื่อถือ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason4" name="reasonNotBuyBuzz" value="รูปแบบแพ็คเกจไม่โดดเด่น ไม่น่าสนใจ" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason4">รูปแบบแพ็คเกจไม่โดดเด่น ไม่น่าสนใจ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason5" name="reasonNotBuyBuzz" value="ไม่พบสินค้าในร้านค้า/หาซื้อได้ยาก" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason5">ไม่พบสินค้าในร้านค้า/หาซื้อได้ยาก</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason6" name="reasonNotBuyBuzz" value="มียี่ห้อที่ซื้อประจำอยู่แล้ว" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason6">มียี่ห้อที่ซื้อประจำอยู่แล้ว</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason7" name="reasonNotBuyBuzz" value="เคยซื้อแล้ว แต่ไม่พอใจในคุณภาพ" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason7">เคยซื้อแล้ว แต่ไม่พอใจในคุณภาพ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason8" name="reasonNotBuyBuzz" value="สินค้าไม่หลากหลาย ไม่มีรูปแบบสินค้าที่ต้องการ" onchange="updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount')">
                        <label for="reason8">สินค้าไม่หลากหลาย ไม่มีรูปแบบสินค้าที่ต้องการ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="reason9" name="reasonNotBuyBuzz" value="อื่น ๆ" onchange="toggleReasonOther(); updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount');">
                        <label for="reason9">อื่น ๆ</label>
                      </div>
                    </div>
                    
                    <!-- กล่องกรอกอื่นๆ สำหรับเหตุผล -->
                    <div class="form-group hidden-field" id="reasonOtherGroup" style="margin-top: 15px;">
                      <input type="text" id="reasonOther" name="reasonOther" placeholder="กรุณาระบุเหตุผลอื่นๆ">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 3. ช่องทางในการรับข่าวสาร -->
          <div class="form-section">
            <h3 class="form-section-title">พฤติกรรมผู้บริโภค</h3>
            
            <div class="form-group">
              <label for="marketingChannel" class="required-field">คุณรู้จัก Buzz จากสื่อ/ช่องทางใด (เลือกได้หลายข้อ, หากไม่รู้จัก กรุณาตอบไม่รู้จัก)</label>
              
              <div class="collapsible-section">
                <button type="button" class="collapsible-header" onclick="toggleCollapsible('channelCollapse')">
                  <span>เลือกช่องทาง</span>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="selected-count" id="channelSelectedCount">0</span>
                    <span class="arrow">▼</span>
                  </div>
                </button>
                
                <div class="collapsible-content" id="channelCollapse">
                  <div class="collapsible-inner">
                    <div class="checkbox-group">
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel1" name="marketingChannelMultiple" value="ช่องทางออนไลน์ของ Buzz (FB,IG,TikTok,X เป็นต้น)" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel1">ช่องทางออนไลน์ของ Buzz (FB,IG,TikTok,X เป็นต้น)</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel2" name="marketingChannelMultiple" value="เพื่อน/คนรู้จักแนะนำ" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel2">เพื่อน/คนรู้จักแนะนำ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel3" name="marketingChannelMultiple" value="สัตวแพทย์แนะนำ" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel3">สัตวแพทย์แนะนำ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel4" name="marketingChannelMultiple" value="เห็นสินค้า/ป้ายโฆษณา ในร้านอาหารสัตว์เลี้ยง" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel4">เห็นสินค้า/ป้ายโฆษณา ในร้านอาหารสัตว์เลี้ยง</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel5" name="marketingChannelMultiple" value="งานอีเวนท์สัตว์เลี้ยง" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel5">งานอีเวนท์สัตว์เลี้ยง</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel6" name="marketingChannelMultiple" value="โฆษณาบนสื่อออนไลน์" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel6">โฆษณาบนสื่อออนไลน์</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel7" name="marketingChannelMultiple" value="รีวิวบนสื่อออนไลน์, อินฟลูเอ็นเซอร์, กลุ่มสัตว์เลี้ยงบน FB" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel7">รีวิวบนสื่อออนไลน์, อินฟลูเอ็นเซอร์, กลุ่มสัตว์เลี้ยงบน FB</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel8" name="marketingChannelMultiple" value="โฆษณาวิทยุ" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel8">โฆษณาวิทยุ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel9" name="marketingChannelMultiple" value="ป้ายโฆษณานอกบ้าน, สื่อ Out-of-Home" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel9">ป้ายโฆษณานอกบ้าน, สื่อ Out-of-Home</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel10" name="marketingChannelMultiple" value="ไม่รู้จัก Buzz" onchange="updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel10">ไม่รู้จัก Buzz</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="channel11" name="marketingChannelMultiple" value="อื่น ๆ" onchange="toggleChannelOther(); updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount'); toggleReceiptUpload();">
                        <label for="channel11">อื่น ๆ</label>
                      </div>
                    </div>
                    
                    <!-- กล่องกรอกอื่นๆ สำหรับช่องทาง -->
                    <div class="form-group hidden-field" id="channelOtherGroup" style="margin-top: 15px;">
                      <input type="text" id="channelOther" name="channelOther" placeholder="กรุณาระบุช่องทางอื่นๆ">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-group" id="receiptUploadGroup" style="display: none;">
              <label for="receipt">อัพโหลดใบเสร็จ</label>
              <div class="file-input-container">
                <input type="file" id="receipt" name="receipt" accept="image/*" onchange="previewImage(this)">
                <span class="asterisk-note">รองรับไฟล์ภาพ เช่น JPG, PNG</span>
              </div>
              <img id="imagePreview" src="#" alt="ตัวอย่างรูปภาพ" />
            </div>

            <!-- ปัจจัยที่สำคัญที่สุด 3 ข้อ -->
            <div class="form-group">
              <label class="required-field">ปัจจัยที่สำคัญที่สุด 3 ข้อ ที่คุณจะเลือกซื้ออาหารเม็ดสุนัข/แมว (เลือกตอบได้เพียง 3 ข้อ)</label>
              <p style="font-size: 0.9rem; color: #B0C4DE; margin-bottom: 15px;">(1 สำคัญที่สุด และ 2,3 สำคัญรองลงมา)</p>
              
              <div class="factors-container">
                <div class="factor-item">
                  <label for="factor1">ลำดับที่ 1 (สำคัญที่สุด)</label>
                  <select id="factor1" name="factor1" required onchange="updateFactorOptions()">
                    <option value="">-- กรุณาเลือก --</option>
                  </select>
                  <!-- กล่องกรอกอื่นๆ สำหรับลำดับที่ 1 -->
                  <div class="form-group hidden-field" id="factor1OtherGroup" style="margin-top: 10px;">
                    <input type="text" id="factor1Other" name="factor1Other" placeholder="กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 1">
                  </div>
                </div>
                
                <div class="factor-item">
                  <label for="factor2">ลำดับที่ 2</label>
                  <select id="factor2" name="factor2" required onchange="updateFactorOptions()">
                    <option value="">-- กรุณาเลือก --</option>
                  </select>
                  <!-- กล่องกรอกอื่นๆ สำหรับลำดับที่ 2 -->
                  <div class="form-group hidden-field" id="factor2OtherGroup" style="margin-top: 10px;">
                    <input type="text" id="factor2Other" name="factor2Other" placeholder="กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 2">
                  </div>
                </div>
                
                <div class="factor-item">
                  <label for="factor3">ลำดับที่ 3</label>
                  <select id="factor3" name="factor3" required onchange="updateFactorOptions()">
                    <option value="">-- กรุณาเลือก --</option>
                  </select>
                  <!-- กล่องกรอกอื่นๆ สำหรับลำดับที่ 3 -->
                  <div class="form-group hidden-field" id="factor3OtherGroup" style="margin-top: 10px;">
                    <input type="text" id="factor3Other" name="factor3Other" placeholder="กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 3">
                  </div>
                </div>
              </div>
            </div>

            <!-- คุณต้องการให้ Buzz ปรับปรุงเรื่องอะไรมากที่สุด -->
            <div class="form-group">
              <label>คุณต้องการให้ Buzz ปรับปรุงเรื่องอะไรมากที่สุด? (ตอบได้หลายข้อ)</label>
              
              <div class="collapsible-section">
                <button type="button" class="collapsible-header" onclick="toggleCollapsible('improveCollapse')">
                  <span>เลือกข้อเสนอแนะ</span>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="selected-count" id="improveSelectedCount">0</span>
                    <span class="arrow">▼</span>
                  </div>
                </button>
                
                <div class="collapsible-content" id="improveCollapse">
                  <div class="collapsible-inner">
                    <div class="checkbox-group">
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve1" name="improvementSuggestions" value="คุณภาพ" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve1">คุณภาพ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve2" name="improvementSuggestions" value="ราคา" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve2">ราคา</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve3" name="improvementSuggestions" value="รูปลักษณ์ ดีไซน์ถุง/แพ็คเกจ" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve3">รูปลักษณ์ ดีไซน์ถุง/แพ็คเกจ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve4" name="improvementSuggestions" value="โปรโมชัน, ของแถมพิเศษ" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve4">โปรโมชัน, ของแถมพิเศษ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve5" name="improvementSuggestions" value="ความหลากหลายของสินค้า เช่น มีขนมเลีย, อาหารเปียก, อาหารเฉพาะสายพันธุ์" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve5">ความหลากหลายของสินค้า เช่น มีขนมเลีย, อาหารเปียก, อาหารเฉพาะสายพันธุ์</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve6" name="improvementSuggestions" value="ความหลากหลายของรสชาติ" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve6">ความหลากหลายของรสชาติ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve7" name="improvementSuggestions" value="การโปรโมท การทำการตลาด ให้สินค้าเป็นที่รู้จัก" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve7">การโปรโมท การทำการตลาด ให้สินค้าเป็นที่รู้จัก</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve8" name="improvementSuggestions" value="ระบบบริการหลังการขาย" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve8">ระบบบริการหลังการขาย</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve9" name="improvementSuggestions" value="มีการรับรองคุณภาพจากสัตวแพทย์/สถาบันที่น่าเชื่อถือ" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve9">มีการรับรองคุณภาพจากสัตวแพทย์/สถาบันที่น่าเชื่อถือ</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve10" name="improvementSuggestions" value="แจกตัวอย่างทดลองให้มากขึ้น" onchange="updateSelectedCount('improvementSuggestions', 'improveSelectedCount')">
                        <label for="improve10">แจกตัวอย่างทดลองให้มากขึ้น</label>
                      </div>
                      <div class="checkbox-item">
                        <input type="checkbox" id="improve11" name="improvementSuggestions" value="อื่นๆ" onchange="toggleImproveOther(); updateSelectedCount('improvementSuggestions', 'improveSelectedCount');">
                        <label for="improve11">อื่นๆ</label>
                      </div>
                    </div>
                    
                    <!-- กล่องกรอกอื่นๆ สำหรับการปรับปรุง -->
                    <div class="form-group hidden-field" id="improveOtherGroup" style="margin-top: 15px;">
                      <input type="text" id="improveOther" name="improveOther" placeholder="กรุณาระบุข้อเสนอแนะอื่นๆ">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 4. ที่อยู่ในการจัดส่งผลิตภัณฑ์อาหารตัวอย่าง -->
          <div class="form-section">
            <h3 class="form-section-title">ที่อยู่ในการจัดส่งผลิตภัณฑ์อาหารตัวอย่าง</h3>
            
            <!-- บ้านเลขที่ -->
            <div class="form-group">
              <label for="houseNumber" class="required-field">บ้านเลขที่</label>
              <input type="text" id="houseNumber" name="houseNumber" required placeholder="กรุณากรอกบ้านเลขที่">
            </div>
            
            <!-- ชื่อหมู่บ้าน/ชื่ออาคาร -->
            <div class="form-group">
              <label for="villageOrBuilding">ชื่อหมู่บ้าน/ชื่ออาคาร</label>
              <input type="text" id="villageOrBuilding" name="villageOrBuilding" placeholder="กรุณากรอกชื่อหมู่บ้านหรือชื่ออาคาร (ถ้ามี)">
            </div>
            
            <!-- หมู่ที่ -->
            <div class="form-group">
              <label for="moo">หมู่ที่</label>
              <input type="text" id="moo" name="moo" placeholder="กรุณากรอกหมู่ที่ (ถ้ามี)">
            </div>
            
            <!-- ซอย -->
            <div class="form-group">
              <label for="soi">ซอย</label>
              <input type="text" id="soi" name="soi" placeholder="กรุณากรอกซอย (ถ้ามี)">
            </div>
            
            <!-- ถนน -->
            <div class="form-group">
              <label for="road">ถนน</label>
              <input type="text" id="road" name="road" placeholder="กรุณากรอกถนน (ถ้ามี)">
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="province" class="required-field">จังหวัด</label>
                  <select id="province" name="province" required onchange="loadDistricts()">
                    <option value="">-- กรุณาเลือก --</option>
                    <!-- จะถูกเติมด้วย JavaScript -->
                  </select>
                </div>
              </div>
              
              <div class="form-col">
                <div class="form-group">
                  <label for="district" class="required-field">อำเภอ</label>
                  <select id="district" name="district" required onchange="loadSubdistricts()" disabled>
                    <option value="">-- กรุณาเลือก --</option>
                    <!-- จะถูกเติมด้วย JavaScript -->
                  </select>
                </div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="subdistrict" class="required-field">ตำบล</label>
                  <select id="subdistrict" name="subdistrict" required onchange="loadPostcode()" disabled>
                    <option value="">-- กรุณาเลือก --</option>
                    <!-- จะถูกเติมด้วย JavaScript -->
                  </select>
                </div>
              </div>
              
              <div class="form-col">
                <div class="form-group">
                  <label for="postcode" class="required-field">รหัสไปรษณีย์</label>
                  <select id="postcode" name="postcode" required disabled>
                    <option value="">-- กรุณาเลือก --</option>
                    <!-- จะถูกเติมด้วย JavaScript -->
                  </select>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 5. ข้อมูลติดต่อ -->
          <div class="form-section">
            <h3 class="form-section-title">ข้อมูลติดต่อ</h3>
            
            <div class="form-group">
              <label for="phone" class="required-field">เบอร์ติดต่อ</label>
              <div class="phone-input-container">
                <span class="phone-prefix">+66</span>
                <input type="tel" id="phone" name="phone" class="phone-input" required pattern="[0-9]{9,10}" title="กรุณากรอกเบอร์โทรศัพท์ 9-10 หลัก" placeholder="ตัวอย่าง 981234567 (ไม่ต้องใส่เลข 0)">
              </div>
              <div id="phoneError" class="error-message">กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง</div>
            </div>
            
            <div class="form-group">
              <label for="email" class="required-field">อีเมล</label>
              <input type="email" id="email" name="email" required placeholder="example@email.com">
              <div id="emailError" class="error-message">กรุณากรอกอีเมลให้ถูกต้อง</div>
            </div>

            <div class="form-section">
              <label for="sampleProduct" class="required-field">คุณต้องการรับสินค้าตัวอย่าง Buzz Netura Holistic Grain Free สูตรใด</label>
              <select id="sampleProduct" name="sampleProduct" required>
                <option value="">-- กรุณาเลือกสัตว์เลี้ยงก่อน --</option>
              </select>
            </div>
          </div>
          
          <!-- 6. เงื่อนไขและข้อตกลง Section -->
          <div class="form-section">
            <h3 class="form-section-title">เงื่อนไขและข้อตกลง</h3>
            
            <!-- กล่องที่ 1 -->
            <div class="terms-box" style="padding: 20px; margin-bottom: 15px; border-radius: 12px; background-color: #07476c; border-left: 4px solid #3db3e3;">
              <div style="margin-bottom: 15px;">
                ยอมรับ เงื่อนไขและข้อกำหนดการรับอาหารแมวหรือสุนัข Buzz Netura Holistic Grain Free ขนาดทดลองฟรี
                ตั้งแต่วันนี้ – 31 ธันวาคม 2568 เท่านั้น
              </div>
            
              <div style="display: flex; align-items: flex-start; padding: 0;">
                <input type="checkbox" id="terms1" name="terms1" required style="margin-right: 12px; margin-top: 4px; width: 20px; height: 20px;">
                <label for="terms1" style="flex: 1; color: #ffffff; line-height: 1.5; font-weight: 400; font-size: 0.95rem;">
                  ท่านสามารถลงทะเบียนรับผลิตภัณฑ์อาหารแมวหรือสุนัข Buzz Netura Holistic Grain Free ขนาดทดลองฟรี ได้ตั้งแต่วันนี้ – 31 ธันวาคม 2568 เท่านั้น
                  สงวนสิทธิ์การรับผลิตภัณฑ์สำหรับผู้ที่ไม่เคยใช้ผลิตภัณฑ์อาหารแมวหรือสุนัข Buzz Netura Holistic Grain Free มาก่อน
                  จำกัดจำนวน 1 ชิ้น ต่อ 1 ท่าน ต่อ 1 ที่อยู่ ตลอดระยะเวลาการลงทะเบียนที่กำหนด
                  ผลิตภัณฑ์จะถูกจัดส่งทางไปรษณีย์ตามที่อยู่ที่ระบุภายใน 30 วันทำการ หลังจากวันที่ท่านลงทะเบียนสำเร็จ
                  <span style="color: #ff5252;">*</span>
                </label>
              </div>
            </div>
            
            <!-- กล่องที่ 2 (รวมกล่อง 3, 4, 5) -->
            <div class="terms-box" style="padding: 20px; margin-bottom: 15px; border-radius: 12px; background-color: #07476c; border-left: 4px solid #3db3e3;">
              <!-- กล่อง 3 - ไม่มี checkbox -->
              <div style="margin-bottom: 20px; color: #ffffff; line-height: 1.5; font-size: 0.95rem;">
                บริษัท ออสแทม กู๊ดส์ จำกัด (บริษัทฯ) ขอความยินยอมจากท่านในการใช้ข้อมูลส่วนบุคคล (เช่น ข้อมูลเฉพาะตัวบุคคล ข้อมูลเกี่ยวกับคุณลักษณะของบุคคล ข้อมูลการติดต่อ ข้อมูลพฤติกรรมหรือข้อมูลเกี่ยวกับสินค้าและบริการ) เพิ่มเติมจากวัตถุประสงค์เพื่อจัดส่งสินค้าตัวอย่าง ตาม พ.ร.บ.คุ้มครองข้อมูลส่วนบุคคล ดังนี้
              </div>
              
              <!-- กล่อง 4 - มี checkbox -->
              <div style="display: flex; align-items: flex-start; margin-bottom: 15px; padding: 0;">
                <input type="checkbox" id="terms2" name="terms2" style="margin-right: 12px; margin-top: 4px; width: 20px; height: 20px;">
                <label for="terms2" style="flex: 1; color: #ffffff; line-height: 1.5; font-weight: 400; font-size: 0.95rem;">
                    ยินยอมให้บริษัทฯ เก็บรวบรวมและใช้ข้อมูลเพื่อสื่อสารการตลาด ตลอดจนส่งเสริมการขาย ผ่านช่องทาง SMS, โซเชียลมีเดีย, อีเมล, ไปรษณีย์ หรือช่องทางการติดต่ออื่นๆ เพื่อนำเสนอข่าวสาร โปรโมชัน ข้อเสนอพิเศษ หรือ แคมเปญทางการตลาด
                </label>
              </div>
              
              <!-- กล่อง 5 - มี checkbox -->
              <div style="display: flex; align-items: flex-start; margin-bottom: 20px; padding: 0;">
                <input type="checkbox" id="terms3" name="terms3" style="margin-right: 12px; margin-top: 4px; width: 20px; height: 20px;">
                <label for="terms3" style="flex: 1; color: #ffffff; line-height: 1.5; font-weight: 400; font-size: 0.95rem;">
                  ยินยอมให้บริษัทฯ ใช้ข้อมูลของท่าน เพื่อมาวิเคราะห์ความต้องการของลูกค้า พัฒนาสินค้าหรือบริการและนำเสนอโปรโมชันที่เหมาะสมสำหรับท่าน
                </label>
              </div>
              
              <!-- เส้นคั่นบาง ๆ -->
              <div style="height: 1px; background-color: rgba(255, 255, 255, 0.1); margin: 15px 0;"></div>
              
              <!-- ข้อความด้านล่าง -->
              <div style="color: #ddd; font-size: 0.9rem; font-style: italic; line-height: 1.5;">
                    โปรดทราบ: การให้ความยินยอมข้างต้นเป็นไปโดยสมัครใจ และไม่มีผลต่อการรับสินค้าตัวอย่าง ท่านสามารถถอนความยินยอม เพิกถอนได้ โดยติดต่อ inquiries@buzzpetsfood.com ทั้งนี้ท่านสามารถศึกษา <a href="https://drive.google.com/file/d/19sAPkedNiCssaEXa0QvurxyX8dJcn08_/view?usp=sharing" target="_blank" rel="noopener noreferrer" style="color: #00b7ff; text-decoration: underline;">นโยบายข้อมูลส่วนบุคคล</a>
              </div>
            </div>
          </div>
          
          <div id="errorMessages" style="color: red; margin-bottom: 15px;"></div>
          
          <button type="submit" class="btn">ลงทะเบียนรับสิทธิ์</button>
        </form>
        
        <div id="loading">
          <div class="spinner"></div>
          <p>กำลังส่งข้อมูล กรุณารอสักครู่...</p>
        </div>
      </div>
      
      <div id="thankYouMessage" class="thank-you-message">
        <h2>THANK YOU</h2>
        <p>ขอบพระคุณที่ให้ความสนใจ แบรนด์อาหารสัตว์เลี้ยง BUZZ PETS FOOD</p>
        <p>เราจะจัดส่งผลิตภัณฑ์ตัวอย่างให้ท่านภายใน 30 วัน หลังจากการลงทะเบียน</p>
      </div>
    </div>
  </div>

  <script>
    // ============== Configuration ==============
    // **ใส่ URL ของ Supabase Edge Function ที่คุณ deploy แล้ว**
    const SUPABASE_FUNCTION_URL = 'https://your-project.supabase.co/functions/v1/survey-api';
    
    // Global variables
    let postCodeData = [];
    
    // Updated pet food brands based on pet type
    let petFoodBrands = {
      แมว: [
        'Acana',
        'AvoDerm',
        'Cat n Joy',
        'Clover',
        'Hill\'s Science Diet',
        'Kaniva',
        'Lifemate',
        'Maxima',
        'Me-O',
        'Me-O Gold',
        'Mr.Vet',
        'Nekko',
        'Orijen',
        'Ostech',
        'Petheria',
        'Pramy',
        'ProWild',
        'Purina ONE',
        'Purina Pro Plan',
        'Royal Canin',
        'SmartHeart',
        'SmartHeart Gold',
        'Solid Gold',
        'Taste of the WILD',
        'Wellness CORE',
        'Whiskas',
        'ไม่ใช้อาหารเม็ด',
        'อื่นๆ'
      ],
      สุนัข: [
        'Acana',
        'AvoDerm',
        'Deserve',
        'Dog Days',
        'Dog n joy',
        'Earthborn',
        'Happy Dog',
        'Hill\'s Science Diet',
        'Jerhigh',
        'Kaniva',
        'LuvCare',
        'Maxima',
        'Mr.Vet',
        'Orijen',
        'Ostech',
        'Pawdy',
        'Pedigree',
        'Pinnacle',
        'PRAMA Delicacy',
        'ProWild',
        'Purina Pro Plan',
        'Royal Canin',
        'SmartHeart',
        'Solid Gold',
        'Taste of the WILD',
        'Wellness CORE',
        'ไม่ใช้อาหารเม็ด',
        'อื่นๆ'
      ]
    };

    let factorOptions = [
        'ราคาคุ้มค่า',
        'อาหารสัตว์เลี้ยงระดับ Holistic Grain Free',
        'แบรนด์เป็นที่รู้จัก',
        'ความน่าเชื่อถือของแบรนด์',
        'สัตวแพทย์แนะนำ',
        'ถุง/แพ็คเกจสวยงาม น่าซื้อ',
        'อาหารที่สัตว์เลี้ยงชอบทาน ทานง่าย',
        'คุณภาพวัตถุดิบระดับสูง',
        'มีรีวิวที่ดีจาก อินฟลูเอ็นเซอร์, กลุ่มสัตว์เลี้ยงบนโลกออนไลน์',
        'มีโปรโมชัน, ของแถมที่น่าสนใจ',
        'สินค้ามีพรีเซนเตอร์/ดารา',
        'อื่นๆ'
    ];
    
    // ============== API Functions ==============
    async function callSupabaseAPI(action, data = null) {
      const url = `${SUPABASE_FUNCTION_URL}?action=${action}`;
      
      const options = {
        method: data ? 'POST' : 'GET',
        headers: {
          'Content-Type': 'application/json',
        }
      };
      
      if (data) {
        options.body = JSON.stringify(data);
      }
      
      try {
        const response = await fetch(url, options);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('Error calling Supabase API:', error);
        throw error;
      }
    }
    
    // ============== Initialization ==============
    window.onload = function() {
      // Try to fetch postcode data
      callSupabaseAPI('getPostCodeData')
        .then(data => {
          onPostCodeDataReceived(data);
        })
        .catch(error => {
          console.error("Error loading postcode data:", error);
          showError('ไม่สามารถโหลดข้อมูลรหัสไปรษณีย์ได้ กรุณาลองใหม่อีกครั้ง');
        });
      
      // โหลดตัวเลือกปัจจัย
      loadFactorOptions();
      
      // Initialize selected counts
      updateSelectedCount('reasonNotBuyBuzz', 'reasonSelectedCount');
      updateSelectedCount('marketingChannelMultiple', 'channelSelectedCount');
      updateSelectedCount('improvementSuggestions', 'improveSelectedCount');
      updateSelectedCount('currentBrandMultiple', 'brandSelectedCount');
      
      // Setup event listeners
      setupBrandOtherListener();
      
      // Add validation event listeners
      document.getElementById('phone').addEventListener('input', validatePhone);
      document.getElementById('email').addEventListener('input', validateEmail);
      
      // Ensure error messages div is initially hidden
      document.getElementById('errorMessages').style.display = 'none';
      
      // Add submit event listener to form
      document.getElementById('surveyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm();
      });
    };

    function showError(message) {
      const errorDiv = document.getElementById('errorMessages');
      errorDiv.innerHTML = `<p style="color: var(--error-color); font-weight: bold; text-align: center; padding: 15px; background-color: #ffebee; border-radius: var(--border-radius); border-left: 4px solid var(--error-color);">${message}</p>`;
      errorDiv.style.display = 'block';
      errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Updated function to load brands based on pet type and also update sample options
    function updatePetBrandsAndSampleOptions() {
      const petType = document.getElementById('petType').value;
      
      // Update brand list
      updateBrandList(petType);
      
      // Update sample product options
      updateSampleOptions();
    }

    // Function to update brand list based on selected pet type
    function updateBrandList(petType) {
      const brandCheckboxGroup = document.getElementById('brandCheckboxGroup');
      brandCheckboxGroup.innerHTML = ''; // Clear existing checkboxes
      
      let brandsToShow = [];
      
      if (petType === 'แมว') {
        brandsToShow = [...petFoodBrands.แมว];
      } else if (petType === 'สุนัข') {
        brandsToShow = [...petFoodBrands.สุนัข];
      } else if (petType === 'สุนัขและแมว') {
        // Combine both lists and remove duplicates
        const combinedBrands = [...petFoodBrands.แมว, ...petFoodBrands.สุนัข];
        let uniqueBrands = [...new Set(combinedBrands)];
        
        // Remove special items for sorting
        const specialItems = ['ไม่ใช้อาหารเม็ด', 'อื่นๆ'];
        const regularBrands = uniqueBrands.filter(brand => !specialItems.includes(brand));
        const foundSpecialItems = specialItems.filter(item => uniqueBrands.includes(item));
        
        // Sort regular brands and add special items at the end in correct order
        brandsToShow = [...regularBrands.sort(), ...foundSpecialItems];
      }
      
      // Create checkbox items for brands
      brandsToShow.forEach((brand, index) => {
        const checkboxItem = document.createElement('div');
        checkboxItem.className = 'checkbox-item';
        
        const checkboxId = `brand${index + 1}`;
        const onchangeAction = brand === 'อื่นๆ' ? 
          `toggleBrandOther(); updateSelectedCount('currentBrandMultiple', 'brandSelectedCount');` :
          `updateSelectedCount('currentBrandMultiple', 'brandSelectedCount')`;
        
        checkboxItem.innerHTML = `
          <input type="checkbox" id="${checkboxId}" name="currentBrandMultiple" value="${brand}" onchange="${onchangeAction}">
          <label for="${checkboxId}">${brand}</label>
        `;
        
        brandCheckboxGroup.appendChild(checkboxItem);
      });
      
      // Reset brand selection count
      updateSelectedCount('currentBrandMultiple', 'brandSelectedCount');
      
      // Clear brand preview
      document.getElementById('brandSelectedPreview').innerHTML = '';
      
      // Hide other brand input if visible
      document.getElementById('brandOtherGroup').classList.add('hidden-field');
      document.getElementById('currentBrandOther').value = '';
    }

    // โหลดตัวเลือกปัจจัยสำหรับ dropdown ทั้ง 3
    function loadFactorOptions() {
      const factorSelects = ['factor1', 'factor2', 'factor3'];
      
      factorSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        select.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
        
        factorOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option;
          optionElement.text = option;
          select.appendChild(optionElement);
        });
      });
    }

    // อัปเดตตัวเลือกปัจจัยเมื่อมีการเลือก
    function updateFactorOptions() {
      const factor1 = document.getElementById('factor1').value;
      const factor2 = document.getElementById('factor2').value;
      const factor3 = document.getElementById('factor3').value;
      
      const selectedValues = [factor1, factor2, factor3].filter(val => val !== '');
      
      // ตรวจสอบและแสดงช่องกรอก "อื่นๆ" สำหรับแต่ละลำดับ
      // ลำดับที่ 1
      const factor1OtherGroup = document.getElementById('factor1OtherGroup');
      if (factor1 === 'อื่นๆ') {
        factor1OtherGroup.classList.remove('hidden-field');
        setTimeout(() => {
          factor1OtherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          document.getElementById('factor1Other').focus();
        }, 300);
      } else {
        factor1OtherGroup.classList.add('hidden-field');
        document.getElementById('factor1Other').value = '';
      }
      
      // ลำดับที่ 2
      const factor2OtherGroup = document.getElementById('factor2OtherGroup');
      if (factor2 === 'อื่นๆ') {
        factor2OtherGroup.classList.remove('hidden-field');
        setTimeout(() => {
          factor2OtherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          document.getElementById('factor2Other').focus();
        }, 300);
      } else {
        factor2OtherGroup.classList.add('hidden-field');
        document.getElementById('factor2Other').value = '';
      }
      
      // ลำดับที่ 3
      const factor3OtherGroup = document.getElementById('factor3OtherGroup');
      if (factor3 === 'อื่นๆ') {
        factor3OtherGroup.classList.remove('hidden-field');
        setTimeout(() => {
          factor3OtherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          document.getElementById('factor3Other').focus();
        }, 300);
      } else {
        factor3OtherGroup.classList.add('hidden-field');
        document.getElementById('factor3Other').value = '';
      }
      
      // ปิดกั้นตัวเลือกที่ถูกเลือกแล้วใน dropdown อื่นๆ
      const factorSelects = ['factor1', 'factor2', 'factor3'];
      
      factorSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        const currentValue = select.value;
        
        // เก็บตัวเลือกปัจจุบัน
        select.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
        
        factorOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option;
          optionElement.text = option;
          
          // ปิดกั้นตัวเลือกที่ถูกเลือกแล้วในช่องอื่น
          if (selectedValues.includes(option) && currentValue !== option) {
            optionElement.disabled = true;
            optionElement.text += ' (เลือกแล้ว)';
          }
          
          select.appendChild(optionElement);
        });
        
        // คืนค่าเดิม
        select.value = currentValue;
      });
    }

    // แสดง/ซ่อนช่องกรอกอาชีพอื่นๆ
    function toggleOccupationOther() {
      const occupation = document.getElementById('occupation').value;
      const otherGroup = document.getElementById('occupationOtherGroup');
      
      if (occupation === 'อื่น ๆ') {
        otherGroup.classList.remove('hidden-field');
        document.getElementById('occupationOther').required = true;
        // เพิ่ม animation และ scroll ไปยังช่องกรอก
        setTimeout(() => {
          otherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          // Focus ไปที่ input field
          document.getElementById('occupationOther').focus();
        }, 300);
      } else {
        otherGroup.classList.add('hidden-field');
        document.getElementById('occupationOther').required = false;
        document.getElementById('occupationOther').value = '';
      }
    }

    // แสดง/ซ่อนช่องกรอกแบรนด์อื่นๆ
    function toggleBrandOther() {
      const isChecked = document.querySelector('input[name="currentBrandMultiple"][value="อื่นๆ"]').checked;
      const otherGroup = document.getElementById('brandOtherGroup');
      
      if (isChecked) {
        otherGroup.classList.remove('hidden-field');
        // เพิ่ม animation และ scroll ไปยังช่องกรอก
        setTimeout(() => {
          otherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          // Focus ไปที่ input field
          document.getElementById('currentBrandOther').focus();
        }, 300);
      } else {
        otherGroup.classList.add('hidden-field');
        // ล้างเฉพาะช่องกรอกข้อความ ไม่ลบค่า "อื่นๆ" ออกจาก checkbox
        document.getElementById('currentBrandOther').value = '';
      }
      
      // อัปเดต preview
      updateBrandPreview();
    }

    // แสดง/ซ่อนช่องกรอกเหตุผลอื่นๆ
    function toggleReasonOther() {
      const isChecked = document.getElementById('reason9').checked;
      const otherGroup = document.getElementById('reasonOtherGroup');
      
      if (isChecked) {
        otherGroup.classList.remove('hidden-field');
        // เพิ่ม animation และ scroll ไปยังช่องกรอก
        setTimeout(() => {
          otherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          // Focus ไปที่ input field
          document.getElementById('reasonOther').focus();
        }, 300);
      } else {
        otherGroup.classList.add('hidden-field');
        document.getElementById('reasonOther').value = '';
      }
    }

    // แสดง/ซ่อนช่องกรอกช่องทางอื่นๆ
    function toggleChannelOther() {
      const isChecked = document.getElementById('channel11').checked;
      const otherGroup = document.getElementById('channelOtherGroup');
      
      if (isChecked) {
        otherGroup.classList.remove('hidden-field');
        // เพิ่ม animation และ scroll ไปยังช่องกรอก
        setTimeout(() => {
          otherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          // Focus ไปที่ input field
          document.getElementById('channelOther').focus();
        }, 300);
      } else {
        otherGroup.classList.add('hidden-field');
        document.getElementById('channelOther').value = '';
      }
    }

    // แสดง/ซ่อนช่องกรอกข้อเสนอแนะอื่นๆ
    function toggleImproveOther() {
      const isChecked = document.getElementById('improve11').checked;
      const otherGroup = document.getElementById('improveOtherGroup');
      
      if (isChecked) {
        otherGroup.classList.remove('hidden-field');
        // เพิ่ม animation และ scroll ไปยังช่องกรอก
        setTimeout(() => {
          otherGroup.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          // Focus ไปที่ input field
          document.getElementById('improveOther').focus();
        }, 300);
      } else {
        otherGroup.classList.add('hidden-field');
        document.getElementById('improveOther').value = '';
      }
    }

    // อัปเดตตัวเลือกสินค้าตัวอย่างตามประเภทสัตว์เลี้ยง
    function updateSampleOptions() {
      const petType = document.getElementById('petType').value;
      const sampleSelect = document.getElementById('sampleProduct');
      
      // เคลียร์ตัวเลือกเดิม
      sampleSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      
      if (petType === 'แมว') {
        const catOptions = [
          'Fish & Chicken Formula',
          'Salmon Formula',
          'Whitefish, Herring & Chicken Formula'
        ];
        
        catOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option;
          optionElement.text = option + ' (อาหารแมว)';
          sampleSelect.appendChild(optionElement);
        });
        
      } else if (petType === 'สุนัข') {
        const dogOptions = [
          'Salmon Formula | Small Breed',
          'Salmon Formula | Med-Large Breed',
          'Chicken Formula | Small Breed',
          'Chicken Formula | Med-Large Breed'
        ];
        
        dogOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option;
          optionElement.text = option + ' (อาหารสุนัข)';
          sampleSelect.appendChild(optionElement);
        });
        
      } else if (petType === 'สุนัขและแมว') {
        // แสดงทั้งหมด
        const allOptions = [
          { value: 'Fish & Chicken Formula', text: 'Fish & Chicken Formula (อาหารแมว)' },
          { value: 'Salmon Formula', text: 'Salmon Formula (อาหารแมว)' },
          { value: 'Whitefish, Herring & Chicken Formula', text: 'Whitefish, Herring & Chicken Formula (อาหารแมว)' },
          { value: 'Salmon Formula | Small Breed', text: 'Salmon Formula | Small Breed (อาหารสุนัข)' },
          { value: 'Salmon Formula | Med-Large Breed', text: 'Salmon Formula | Med-Large Breed (อาหารสุนัข)' },
          { value: 'Chicken Formula | Small Breed', text: 'Chicken Formula | Small Breed (อาหารสุนัข)' },
          { value: 'Chicken Formula | Med-Large Breed', text: 'Chicken Formula | Med-Large Breed (อาหารสุนัข)' }
        ];
        
        allOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option.value;
          optionElement.text = option.text;
          sampleSelect.appendChild(optionElement);
        });
      }
    }
    
    // Handle postcode data received from server
    function onPostCodeDataReceived(data) {
      postCodeData = data;
      
      // Populate province dropdown (unique values)
      const provinces = [...new Set(data.map(item => item[3]))].sort();
      const provinceSelect = document.getElementById('province');
      
      provinces.forEach(province => {
        const option = document.createElement('option');
        option.value = province;
        option.text = province;
        provinceSelect.appendChild(option);
      });
    }
    
    // Load districts based on selected province
    function loadDistricts() {
      const provinceValue = document.getElementById('province').value;
      const districtSelect = document.getElementById('district');
      const subdistrictSelect = document.getElementById('subdistrict');
      const postcodeSelect = document.getElementById('postcode');
      
      // Reset and disable dependent dropdowns
      districtSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      subdistrictSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      postcodeSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      
      subdistrictSelect.disabled = true;
      postcodeSelect.disabled = true;
      
      if (!provinceValue) {
        districtSelect.disabled = true;
        return;
      }
      
      // Filter districts by selected province
      const districts = [...new Set(
        postCodeData
          .filter(item => item[3] === provinceValue)
          .map(item => item[2])
      )].sort();
      
      // Populate district dropdown
      districts.forEach(district => {
        const option = document.createElement('option');
        option.value = district;
        option.text = district;
        districtSelect.appendChild(option);
      });
      
      districtSelect.disabled = false;
    }
    
    // Load subdistricts based on selected district
    function loadSubdistricts() {
      const provinceValue = document.getElementById('province').value;
      const districtValue = document.getElementById('district').value;
      const subdistrictSelect = document.getElementById('subdistrict');
      const postcodeSelect = document.getElementById('postcode');
      
      // Reset and disable dependent dropdowns
      subdistrictSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      postcodeSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      
      postcodeSelect.disabled = true;
      
      if (!districtValue) {
        subdistrictSelect.disabled = true;
        return;
      }
      
      // Filter subdistricts by selected province and district
      const subdistricts = [...new Set(
        postCodeData
          .filter(item => item[3] === provinceValue && item[2] === districtValue)
          .map(item => item[1])
      )].sort();
      
      // Populate subdistrict dropdown
      subdistricts.forEach(subdistrict => {
        const option = document.createElement('option');
        option.value = subdistrict;
        option.text = subdistrict;
        subdistrictSelect.appendChild(option);
      });
      
      subdistrictSelect.disabled = false;
    }
    
    // Load postcode based on selected subdistrict
    function loadPostcode() {
      const provinceValue = document.getElementById('province').value;
      const districtValue = document.getElementById('district').value;
      const subdistrictValue = document.getElementById('subdistrict').value;
      const postcodeSelect = document.getElementById('postcode');
      
      // Reset postcode dropdown
      postcodeSelect.innerHTML = '<option value="">-- กรุณาเลือก --</option>';
      
      if (!subdistrictValue) {
        postcodeSelect.disabled = true;
        return;
      }
      
      // Filter postcodes by selected province, district, and subdistrict
      const postcodes = [...new Set(
        postCodeData
          .filter(item => 
            item[3] === provinceValue && 
            item[2] === districtValue && 
            item[1] === subdistrictValue
          )
          .map(item => item[0])
      )].sort();
      
      // Populate postcode dropdown
      postcodes.forEach(postcode => {
        const option = document.createElement('option');
        option.value = postcode;
        option.text = postcode;
        postcodeSelect.appendChild(option);
      });
      
      postcodeSelect.disabled = false;
    }
    
    // Toggle receipt upload field visibility based on marketing channel selection
    function toggleReceiptUpload() {
      const checkedChannels = document.querySelectorAll('input[name="marketingChannelMultiple"]:checked');
      const receiptGroup = document.getElementById('receiptUploadGroup');
      
      // ตรวจสอบว่ามีการเลือก "เห็นสินค้า/ป้ายโฆษณา ในร้านอาหารสัตว์เลี้ยง" หรือไม่
      let showReceipt = false;
      checkedChannels.forEach(checkbox => {
        if (checkbox.value === 'เห็นสินค้า/ป้ายโฆษณา ในร้านอาหารสัตว์เลี้ยง') {
          showReceipt = true;
        }
      });
      
      if (showReceipt) {
        receiptGroup.style.display = 'block';
      } else {
        receiptGroup.style.display = 'none';
        document.getElementById('receipt').value = '';
        document.getElementById('imagePreview').style.display = 'none';
      }
    }
    
    // Preview uploaded image
    function previewImage(input) {
      const preview = document.getElementById('imagePreview');
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        
        reader.readAsDataURL(input.files[0]);
      } else {
        preview.style.display = 'none';
      }
    }

    // Preview uploaded images for pet photos (multiple files)
    function previewUploadedImages(input) {
      const previewContainer = document.getElementById('uploadedImagesPreview');
      const gridContainer = previewContainer.querySelector('div');
      const fileCountDiv = document.getElementById('fileCount');
      
      // ล้างรูปภาพเดิม
      gridContainer.innerHTML = '';
      
      if (input.files && input.files.length > 0) {
        // ตรวจสอบจำนวนไฟล์ไม่เกิน 5
        if (input.files.length > 5) {
          alert('สามารถเลือกได้สูงสุด 5 รูปเท่านั้น กรุณาเลือกใหม่');
          input.value = ''; // ล้างการเลือกไฟล์
          previewContainer.style.display = 'none';
          fileCountDiv.style.display = 'none';
          return;
        }
        
        // ตรวจสอบประเภทไฟล์
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
        
        for (let i = 0; i < input.files.length; i++) {
          const file = input.files[i];
          
          // ตรวจสอบประเภทไฟล์
          if (!allowedTypes.includes(file.type)) {
            alert(`ไฟล์ "${file.name}" ไม่ใช่ไฟล์รูปภาพที่รองรับ\nรองรับเฉพาะ: JPG, JPEG, PNG, GIF, WebP`);
            input.value = '';
            previewContainer.style.display = 'none';
            fileCountDiv.style.display = 'none';
            return;
          }
        }
        
        // แสดงจำนวนไฟล์ที่เลือก
        fileCountDiv.textContent = `เลือกแล้ว ${input.files.length} รูป`;
        fileCountDiv.style.display = 'block';
        
        // สร้าง preview สำหรับแต่ละไฟล์
        Array.from(input.files).forEach((file, index) => {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const imageContainer = document.createElement('div');
            imageContainer.className = 'image-preview-item';
            
            const img = document.createElement('img');
            img.src = e.target.result;
            img.alt = `รูปภาพที่ ${index + 1}`;
            
            // เพิ่มหมายเลขรูปภาพ
            const numberLabel = document.createElement('div');
            numberLabel.className = 'image-number';
            numberLabel.textContent = index + 1;
            
            imageContainer.appendChild(img);
            imageContainer.appendChild(numberLabel);
            gridContainer.appendChild(imageContainer);
          };
          
          reader.onerror = function() {
            alert(`เกิดข้อผิดพลาดในการโหลดไฟล์: ${file.name}`);
          };
          
          reader.readAsDataURL(file);
        });
        
        previewContainer.style.display = 'block';
      } else {
        previewContainer.style.display = 'none';
        fileCountDiv.style.display = 'none';
      }
    }
    
    // Validate phone number format
    function validatePhone() {
      const phoneInput = document.getElementById('phone');
      const phoneError = document.getElementById('phoneError');
      const phonePattern = /^[0-9]{9,10}$/;
      
      if (phoneInput.value && !phonePattern.test(phoneInput.value)) {
        phoneError.style.display = 'block';
        phoneInput.setCustomValidity('กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง');
      } else {
        phoneError.style.display = 'none';
        phoneInput.setCustomValidity('');
      }
    }
    
    // Validate email format
    function validateEmail() {
      const emailInput = document.getElementById('email');
      const emailError = document.getElementById('emailError');
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (emailInput.value && !emailPattern.test(emailInput.value)) {
        emailError.style.display = 'block';
        emailInput.setCustomValidity('กรุณากรอกอีเมลให้ถูกต้อง');
      } else {
        emailError.style.display = 'none';
        emailInput.setCustomValidity('');
      }
    }

    // รวบรวมค่าจาก checkbox groups
    function getCheckboxValues(name) {
      const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // ฟังก์ชันจัดการ collapsible sections
    function toggleCollapsible(targetId) {
      const content = document.getElementById(targetId);
      const header = content.previousElementSibling;
      
      // Toggle active class
      header.classList.toggle('active');
      content.classList.toggle('active');
    }

    // ฟังก์ชันอัปเดตจำนวนที่เลือกในแต่ละ section
    function updateSelectedCount(checkboxName, countElementId) {
      const selectedCount = getCheckboxValues(checkboxName).length;
      document.getElementById(countElementId).textContent = selectedCount;
      
      // อัปเดต preview สำหรับแบรนด์
      if (checkboxName === 'currentBrandMultiple') {
        updateBrandPreview();
      }
    }

    // ฟังก์ชันอัปเดตการแสดงรายการแบรนด์ที่เลือก
    function updateBrandPreview() {
      const selectedBrands = getCheckboxValues('currentBrandMultiple');
      const brandOtherText = document.getElementById('currentBrandOther').value.trim();
      const previewElement = document.getElementById('brandSelectedPreview');
      
      if (selectedBrands.length === 0) {
        previewElement.innerHTML = '';
        return;
      }
      
      let displayItems = [...selectedBrands];
      
      // ถ้าเลือก "อื่นๆ" และมีการกรอกข้อมูล
      if (selectedBrands.includes('อื่นๆ') && brandOtherText) {
        // แทนที่ "อื่นๆ" ด้วยข้อมูลที่กรอก
        const otherIndex = displayItems.indexOf('อื่นๆ');
        displayItems[otherIndex] = `อื่นๆ (${brandOtherText})`;
      }
      
      previewElement.innerHTML = `
        <div class="preview-label">แบรนด์ที่เลือก:</div>
        <div class="preview-items">${displayItems.join(', ')}</div>
      `;
    }

    // เพิ่ม event listener สำหรับช่องกรอก "อื่นๆ" ของแบรนด์
    function setupBrandOtherListener() {
      const brandOtherInput = document.getElementById('currentBrandOther');
      if (brandOtherInput) {
        brandOtherInput.addEventListener('input', updateBrandPreview);
      }
    }
    
    // Validate form before submission
    function validateForm() {
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const houseNumber = document.getElementById('houseNumber').value.trim();
      
      // เพิ่มการตรวจสอบวันเดือนปีเกิด
      const birthDay = document.getElementById('birthDay').value;
      const birthMonth = document.getElementById('birthMonth').value;
      const birthYear = document.getElementById('birthYear').value;

      // ตรวจสอบอาชีพ
      const occupation = document.getElementById('occupation').value;
      const occupationOther = document.getElementById('occupationOther').value.trim();

      // ตรวจสอบแบรนด์
      const currentBrands = getCheckboxValues('currentBrandMultiple');
      const brandOther = document.getElementById('currentBrandOther').value.trim();

      // ตรวจสอบปัจจัยสำคัญ
      const factor1 = document.getElementById('factor1').value;
      const factor2 = document.getElementById('factor2').value;
      const factor3 = document.getElementById('factor3').value;

      // ตรวจสอบช่องทางการรับข่าวสาร (ต้องเลือกอย่างน้อย 1 ข้อ)
      const marketingChannels = getCheckboxValues('marketingChannelMultiple');

      let errorMessage = "";
      
      // ตรวจสอบวันเดือนปีเกิด
      if (!birthDay || !birthMonth || !birthYear) {
        errorMessage = "กรุณาเลือกวันเดือนปีเกิดให้ครบถ้วน";
      }

      // ตรวจสอบอาชีพ
      if (!occupation) {
        errorMessage = "กรุณาเลือกอาชีพ";
      } else if (occupation === "อื่น ๆ" && !occupationOther) {
        errorMessage = "กรุณาระบุรายละเอียดอาชีพ";
      }

      // ตรวจสอบแบรนด์
      if (currentBrands.length === 0) {
        errorMessage = "กรุณาเลือกแบรนด์อาหารเม็ดอย่างน้อย 1 ข้อ";
      }
      
      // ตรวจสอบเบอร์โทรศัพท์ต้องไม่มีอักขระพิเศษ
      if (phone && !/^[0-9]+$/.test(phone)) {
        errorMessage = "กรุณากรอกเบอร์โทรศัพท์เป็นตัวเลขเท่านั้น";
      }
      
      // ตรวจสอบอีเมลต้องถูกต้องตามรูปแบบ
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        errorMessage = "กรุณากรอกอีเมลให้ถูกต้องตามรูปแบบ";
      }
      
      // ตรวจสอบว่าบ้านเลขที่ต้องไม่เป็นค่าว่าง
      if (!houseNumber) {
        errorMessage = "กรุณากรอกบ้านเลขที่";
      }

      // ตรวจสอบปัจจัยสำคัญ 3 ข้อ
      if (!factor1 || !factor2 || !factor3) {
        errorMessage = "กรุณาเลือกปัจจัยสำคัญครบทั้ง 3 ข้อ";
      }
      
      // ตรวจสอบว่าถ้าเลือก "อื่นๆ" แล้วต้องกรอกข้อความด้วย
      if (factor1 === 'อื่นๆ' && !document.getElementById('factor1Other').value.trim()) {
        errorMessage = "กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 1";
      }
      if (factor2 === 'อื่นๆ' && !document.getElementById('factor2Other').value.trim()) {
        errorMessage = "กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 2";
      }
      if (factor3 === 'อื่นๆ' && !document.getElementById('factor3Other').value.trim()) {
        errorMessage = "กรุณาระบุปัจจัยอื่นๆ สำหรับลำดับที่ 3";
      }

      // ตรวจสอบช่องทางการรับข่าวสาร
      if (marketingChannels.length === 0) {
        errorMessage = "กรุณาเลือกช่องทางการรับข่าวสารอย่างน้อย 1 ข้อ";
      }
      
      // ถ้ามีข้อผิดพลาด แสดงข้อความและไม่ส่งฟอร์ม
      if (errorMessage) {
        showError(errorMessage);
        return false;
      }
      
      return true;
    }

    // Fixed form submission function
    function submitForm() {
      console.log("submitForm() called");
      
      // Validate form before submission
      if (!validateForm()) {
        return;
      }
      
      // Show loading spinner
      document.getElementById('loading').style.display = 'block';
      document.getElementById('errorMessages').innerHTML = '';
      document.getElementById('errorMessages').style.display = 'none';
      
      try {
        // รวบรวมค่าจาก checkbox groups
        const reasonNotBuyBuzz = getCheckboxValues('reasonNotBuyBuzz');
        const marketingChannelMultiple = getCheckboxValues('marketingChannelMultiple');
        const improvementSuggestions = getCheckboxValues('improvementSuggestions');
        const currentBrandMultiple = getCheckboxValues('currentBrandMultiple');

        // Collect form data
        const formData = {
          firstName: document.getElementById('firstName').value.trim(),
          lastName: document.getElementById('lastName').value.trim(),
          gender: document.querySelector('input[name="gender"]:checked')?.value || '',
          birthDay: document.getElementById('birthDay').value,
          birthMonth: document.getElementById('birthMonth').value,
          birthYear: document.getElementById('birthYear').value,
          occupation: document.getElementById('occupation').value,
          occupationOther: document.getElementById('occupationOther').value.trim(),
          monthlyIncome: document.getElementById('monthlyIncome').value,
          villageOrBuilding: document.getElementById('villageOrBuilding').value.trim(),
          houseNumber: document.getElementById('houseNumber').value.trim(),
          moo: document.getElementById('moo').value.trim(),
          soi: document.getElementById('soi').value.trim(),
          road: document.getElementById('road').value.trim(),
          province: document.getElementById('province').value,
          district: document.getElementById('district').value,
          subdistrict: document.getElementById('subdistrict').value,
          postcode: document.getElementById('postcode').value,
          phone: document.getElementById('phone').value.trim(),
          email: document.getElementById('email').value.trim(),
          petType: document.getElementById('petType').value,
          petCount: document.getElementById('petCount').value,
          currentBrand: currentBrandMultiple.join(', '),
          currentBrandOther: document.getElementById('currentBrandOther').value.trim(),
          receiptUpload: document.getElementById('receiptUpload').files.length > 0 ? 
            `มี (${document.getElementById('receiptUpload').files.length} รูป)` : 'ไม่มี',
          reasonNotBuyBuzz: reasonNotBuyBuzz.join(', ') + 
            (document.getElementById('reasonOther').value.trim() ? 
              (reasonNotBuyBuzz.length > 0 ? ', ' : '') + document.getElementById('reasonOther').value.trim() : ''),
          monthlyExpense: document.getElementById('monthlyExpense').value,
          marketingChannel: marketingChannelMultiple.join(', ') + 
            (document.getElementById('channelOther').value.trim() ? 
              (marketingChannelMultiple.length > 0 ? ', ' : '') + document.getElementById('channelOther').value.trim() : ''),
          marketingChannelOther: '',
          importantFactors: [
            document.getElementById('factor1').value,
            document.getElementById('factor2').value,
            document.getElementById('factor3').value
          ].filter(val => val !== '').map((val, index) => {
            // ถ้าเลือก "อื่นๆ" ให้นำข้อความที่กรอกมาแทน
            if (val === 'อื่นๆ') {
              const factorNum = index + 1;
              const otherValue = document.getElementById(`factor${factorNum}Other`).value.trim();
              return otherValue || 'อื่นๆ';
            }
            return val;
          }).join(', '),
          improvementSuggestions: improvementSuggestions.join(', ') + 
            (document.getElementById('improveOther').value.trim() ? 
              (improvementSuggestions.length > 0 ? ', ' : '') + document.getElementById('improveOther').value.trim() : ''),
          sampleProduct: document.getElementById('sampleProduct').value,
          terms1: document.getElementById('terms1').checked,
          terms2: document.getElementById('terms2').checked,
          terms3: document.getElementById('terms3').checked
        };
        
        console.log("Form data to be submitted:", formData);
        
        // Check for required fields
        let missingFields = [];
        
        if (!formData.firstName) missingFields.push("ชื่อ");
        if (!formData.lastName) missingFields.push("นามสกุล");
        if (!formData.gender) missingFields.push("เพศ");
        if (!formData.birthDay) missingFields.push("วันเกิด");
        if (!formData.birthMonth) missingFields.push("เดือนเกิด");
        if (!formData.birthYear) missingFields.push("ปีเกิด");
        if (!formData.occupation) missingFields.push("อาชีพ");
        if (formData.occupation === "อื่น ๆ" && !formData.occupationOther.trim()) missingFields.push("รายละเอียดอาชีพ");
        if (!formData.monthlyIncome) missingFields.push("รายได้ต่อเดือน");
        if (!formData.houseNumber) missingFields.push("บ้านเลขที่");
        if (!formData.province) missingFields.push("จังหวัด");
        if (!formData.district) missingFields.push("อำเภอ");
        if (!formData.subdistrict) missingFields.push("ตำบล");
        if (!formData.postcode) missingFields.push("รหัสไปรษณีย์");
        if (!formData.phone) missingFields.push("เบอร์โทรศัพท์");
        if (!formData.email) missingFields.push("อีเมล");
        if (!formData.petType) missingFields.push("ประเภทสัตว์เลี้ยง");
        if (!formData.petCount) missingFields.push("จำนวนสัตว์เลี้ยง");
        if (currentBrandMultiple.length === 0) missingFields.push("แบรนด์ที่ใช้ปัจจุบัน");
        if (!formData.monthlyExpense) missingFields.push("ค่าใช้จ่ายต่อเดือน");
        if (!formData.sampleProduct) missingFields.push("สินค้าตัวอย่างที่ต้องการ");
        if (marketingChannelMultiple.length === 0) missingFields.push("ช่องทางการรับข่าวสาร");
        
        // Check for acceptance of terms
        if (!formData.terms1) missingFields.push("การยอมรับเงื่อนไขข้อที่ 1");
        
        // ตรวจสอบปัจจัยอื่นๆ ถ้าเลือก "อื่นๆ"
        if (document.getElementById('factor1').value === 'อื่นๆ' && !document.getElementById('factor1Other').value.trim()) {
          missingFields.push("ปัจจัยอื่นๆ สำหรับลำดับที่ 1");
        }
        if (document.getElementById('factor2').value === 'อื่นๆ' && !document.getElementById('factor2Other').value.trim()) {
          missingFields.push("ปัจจัยอื่นๆ สำหรับลำดับที่ 2");
        }
        if (document.getElementById('factor3').value === 'อื่นๆ' && !document.getElementById('factor3Other').value.trim()) {
          missingFields.push("ปัจจัยอื่นๆ สำหรับลำดับที่ 3");
        }
        
        if (missingFields.length > 0) {
          console.log("Missing fields:", missingFields);
          document.getElementById('loading').style.display = 'none';
          showError(`กรุณากรอกข้อมูลให้ครบถ้วน: ${missingFields.join(', ')}`);
          return;
        }
        
        // Get file data if uploaded (multiple files support)
        const receiptFileInput = document.getElementById('receipt');
        const receiptFile = receiptFileInput && receiptFileInput.files.length > 0 ? receiptFileInput.files[0] : null;
        
        const uploadedFileInput = document.getElementById('receiptUpload');
        const uploadedFiles = uploadedFileInput && uploadedFileInput.files.length > 0 ? Array.from(uploadedFileInput.files) : [];
        
        // Process multiple file uploads if present
        if (receiptFile) {
          console.log("Receipt file found, processing...");
          const reader = new FileReader();
          reader.onload = function(e) {
            console.log("File read complete");
            const base64Data = e.target.result.split(',')[1]; // Remove data URL prefix
            formData.receiptFile = {
              name: receiptFile.name,
              type: receiptFile.type,
              data: base64Data
            };
            
            // Send form data with file
            sendToServer(formData);
          };
          reader.onerror = function(e) {
            console.error("Error reading file:", e);
            document.getElementById('loading').style.display = 'none';
            showError(`เกิดข้อผิดพลาดในการอ่านไฟล์: ${e.target.error}`);
          };
          reader.readAsDataURL(receiptFile);
        } else if (uploadedFiles.length > 0) {
          console.log(`Found ${uploadedFiles.length} uploaded files, processing...`);
          
          let filesProcessed = 0;
          const filesData = [];
          
          uploadedFiles.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
              const base64Data = e.target.result.split(',')[1]; // Remove data URL prefix
              filesData[index] = {
                name: file.name,
                type: file.type,
                data: base64Data
              };
              
              filesProcessed++;
              
              // เมื่อประมวลผลไฟล์ครบทุกไฟล์แล้ว
              if (filesProcessed === uploadedFiles.length) {
                console.log("All files processed successfully");
                // ส่งไฟล์หลายรูปไปยังเซิร์ฟเวอร์
                formData.receiptFile = filesData.length === 1 ? filesData[0] : filesData; // ถ้า 1 รูปส่งแบบ object, หลายรูปส่งแบบ array
                sendToServer(formData);
              }
            };
            
            reader.onerror = function(e) {
              console.error("Error reading file:", e);
              document.getElementById('loading').style.display = 'none';
              showError(`เกิดข้อผิดพลาดในการอ่านไฟล์: ${file.name}`);
            };
            
            reader.readAsDataURL(file);
          });
        } else {
          // Submit form without file data
          console.log("No files, submitting form data directly");
          sendToServer(formData);
        }
      } catch (error) {
        console.error("Error in submitForm:", error);
        document.getElementById('loading').style.display = 'none';
        showError(`เกิดข้อผิดพลาด: ${error.message || 'ไม่สามารถส่งข้อมูลได้'}`);
      }
    }

    function sendToServer(formData) {
      callSupabaseAPI('submitSurvey', formData)
        .then(response => {
          console.log("Server response:", response);
          
          // ปิดตัวโหลดดิ้ง
          document.getElementById('loading').style.display = 'none';
          
          // ตรวจสอบว่าการบันทึกสำเร็จหรือไม่
          if (response.success) {
            // กรณีบันทึกสำเร็จ - แสดงข้อความขอบคุณ
            try {
              // เคลียร์พื้นที่และจัดการโครงสร้างหน้าเว็บใหม่
              const formContent = document.querySelector('.form-content');
              if (formContent) {
                // ล้างเนื้อหาทั้งหมดในพื้นที่ฟอร์ม
                formContent.innerHTML = '';
                
                // สร้างข้อความขอบคุณ
                const thankYouHTML = `
                  <div id="thankYouMessage" style="display:block; text-align:center; margin:40px auto; padding:40px; background-color:#07476c; border-radius:12px; border-left:4px solid #4caf50; color:#ffffff; max-width:600px;">
                    <h2 style="color:#ffffff; margin-bottom:20px; font-size:28px; font-weight:600;">THANK YOU</h2>
                    <p style="font-size:16px; line-height:1.7; margin-bottom:10px;">ขอบพระคุณที่ให้ความสนใจ แบรนด์อาหารสัตว์เลี้ยง BUZZ PETS FOOD</p>
                    <p style="font-size:16px; line-height:1.7; margin-bottom:10px;">เราจะจัดส่งผลิตภัณฑ์ตัวอย่างให้ท่านภายใน 30 วัน หลังจากการลงทะเบียน</p>
                    <img src="https://i.postimg.cc/0NP58LpV/COVER.jpg" alt="BUZZ PETS FOOD" style="max-width:200px; margin-top:20px;">
                  </div>
                `;
                
                // แทรกข้อความขอบคุณลงในพื้นที่ฟอร์มโดยตรง
                formContent.innerHTML = thankYouHTML;
                
                // เลื่อนไปที่ด้านบนของหน้า
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                console.log("Thank you message created and shown successfully");
              } else {
                // ถ้าไม่พบ form-content ให้ใช้วิธีสร้าง alert แทน
                console.error("Form content element not found");
                alert("ขอบคุณสำหรับการลงทะเบียน! เราจะจัดส่งผลิตภัณฑ์ตัวอย่างให้ท่านภายใน 30 วัน");
              }
            } catch (err) {
              console.error("Error showing thank you message:", err);
              alert("ขอบคุณสำหรับการลงทะเบียน! เราจะจัดส่งผลิตภัณฑ์ตัวอย่างให้ท่านภายใน 30 วัน");
            }
          } else {
            // กรณีพบข้อมูลซ้ำหรือเกิดข้อผิดพลาด - แสดงข้อความแจ้งเตือน
            console.warn("Registration failed:", response.message);
            showError(response.message);
          }
        })
        .catch(error => {
          // ซ่อนตัวโหลดดิ้ง
          document.getElementById('loading').style.display = 'none';
          
          console.error("Server error:", error);
          
          // แสดงข้อความข้อผิดพลาดทั่วไป
          showError('เกิดข้อผิดพลาดในการลงทะเบียน กรุณาลองใหม่อีกครั้ง');
        });
    }
  </script>
</body>
</html>
